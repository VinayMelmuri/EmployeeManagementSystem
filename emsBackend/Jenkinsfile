pipeline {
    agent any
    
    environment {
        // You can define environment variables here, like database credentials
        DB_URL = 'jdbc:mysql://localhost:3306/your_database'
        DB_USERNAME = 'ems'
        DB_PASSWORD = 'Betelnut@999'
    }
    
    stages {
        stage('Checkout') {
            steps {
                git branch: 'main',credentialsId: 'VinayMelmuri', url: 'https://github.com/VinayMelmuri/EmployeeManagementSystem.git'
            }
        }
        
        stage('Build') {
            steps {
				sh './mvnw clean install'
            }
        }

        stage('Liquibase Update') {
            steps {
                sh './mvnw liquibase:update'
            }
        }

        stage('Push Changes to GitHub') {
            steps {
                script {
                    def user = "VinayMelmuri"
                    def email = "vinaymelmuri@gmail.com"
                    
                    sh """
                    git config --global user.name '${user}'
                    git config --global user.email '${email}'
                    git add .
                    git commit -m "Automated update from Jenkins pipeline"
                    git push https://github.com/VinayMelmuri/EmployeeManagementSystem.git
                    """
                }
            }
        }
    }
     post {
        always {
            // Clean up workspace after job execution
            cleanWs()
        }
        success {
            // Notify success (optional: Slack, email, etc.)
            echo 'Build and deployment successful!'
        }
        failure {
            // Notify failure (optional: Slack, email, etc.)
            echo 'Build failed!'
        }
    }
    
}
